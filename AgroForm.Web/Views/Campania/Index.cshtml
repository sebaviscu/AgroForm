@using AgroForm.Web.Models.IndexVM
@model CampaniasIndexVM
@{
    ViewData["Title"] = "Campañas";
}

<style>
    .lote-card {
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }
    
    .lote-card:hover {
        border-color: #0d6efd;
    }
    
    .lote-card .form-check-input:checked ~ .card-body {
        background-color: #e7f1ff;
    }
    
    .lote-card .form-check-input:checked ~ .card-body .card-title {
        color: #0d6efd;
    }
    
    .nav-tabs .nav-link:not(.active) {
        color: #6c757d;
    }

</style>

<!-- Filtros y botón nueva campaña -->
<div class="row mb-3">
    <div class="col-md-4">
        <select id="estadoFilter" class="form-select">
            <option value="">Todos los estados</option>
            <option value="Planificada">Planificada</option>
            <option value="EnCurso">En curso</option>
            <option value="Finalizada">Finalizada</option>
            <option value="Cancelada">Cancelada</option>
        </select>
    </div>
    <div class="col-md-2">
        <button id="btnResetFilters" class="btn btn-secondary btn-sm w-100">
            <i class="bi bi-arrow-counterclockwise"></i> Resetear
        </button>
    </div>
    <div class="col-md-3 offset-md-3 text-end">
        <button id="btnNuevaCampania" class="btn btn-primary btn-sm">
            <i class="bi bi-plus-circle me-1"></i> Nueva Campaña
        </button>
    </div>
</div>

<!-- Tabla principal -->
<table id="tblCampanias" class="table table-striped table-hover w-100">
    <thead>
        <tr>
            <th>Id</th>
            <th>Estado</th>
            <th>Nombre</th>
            <th>Fecha Inicio</th>
            <th>Fecha Fin</th>
            <th>Campo</th>
            <th>Acciones</th>
        </tr>
    </thead>
</table>

<!-- Modal de Campañas -->
<div class="modal fade" id="modalCampania" tabindex="-1" aria-labelledby="modalCampaniaLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <form id="formCampania" novalidate>
                <div class="modal-header">
                    <h5 class="modal-title" id="modalCampaniaLabel">Nueva Campaña</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <!-- Tabs -->
                    <ul class="nav nav-tabs" id="campaniaTabs">
                        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#campos">Campos</button></li>
                        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#lotes" disabled>Lotes</button></li>
                        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#resumen" disabled>Resumen</button></li>
                    </ul>

                    <div class="tab-content pt-3">
                        <!-- TAB CAMPOS -->
                        <div class="tab-pane fade show active" id="campos">
                            <div class="mb-3">
                                <label for="nombre" class="form-label">Nombre de Campaña</label>
                                <input type="text" class="form-control" id="nombre" required>
                            </div>
                            <div class="mb-3">
                                <label for="estado" class="form-label">Estado</label>
                                <select id="estado" class="form-select" required>
                                    <option value="">Seleccione...</option>
                                    <option value="Planificada">Planificada</option>
                                    <option value="EnCurso">En curso</option>
                                    <option value="Finalizada">Finalizada</option>
                                    <option value="Cancelada">Cancelada</option>
                                </select>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="fechaInicio" class="form-label">Fecha Inicio</label>
                                    <input type="date" class="form-control" id="fechaInicio" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="fechaFin" class="form-label">Fecha Fin</label>
                                    <input type="date" class="form-control" id="fechaFin">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="campoSeleccionado" class="form-label">Campo</label>
                                <select id="campoSeleccionado" class="form-select" required></select>
                            </div>

                            <div id="infoCampo" class="alert alert-light border d-none">
                                <div id="campoDetalles"></div>
                            </div>
                        </div>

                        <!-- TAB LOTES -->
                        <div class="tab-pane fade" id="lotes">
                            <h6 id="nombreCampoSeleccionado" class="mb-3"></h6>

                            <!-- Resumen del campo -->
                            <div class="alert alert-light border mb-3" id="infoCampoLotes">
                                <strong>Superficie del Campo:</strong> <span id="campoSuperficieTotal">0</span> Ha<br>
                                <strong>Superficie Asignada:</strong> <span id="superficieAsignada">0</span> Ha<br>
                                <strong>Superficie Disponible:</strong> <span id="superficieDisponible">0</span> Ha
                            </div>

                            <!-- Agregar lote -->
                            <div class="card mb-3">
                                <div class="card-body p-3">
                                    <h6>Agregar Lote</h6>
                                    <div class="row g-2">
                                        <div class="col-md-6">
                                            <input type="text" id="nuevoLoteNombre" class="form-control" placeholder="Nombre del lote">
                                        </div>
                                        <div class="col-md-4">
                                            <input type="number" id="nuevoLoteSuperficie" class="form-control" placeholder="Superficie (Ha)" step="0.01">
                                        </div>
                                        <div class="col-md-2">
                                            <button id="btnAgregarLote" type="button" class="btn btn-success w-100">
                                                <i class="bi bi-plus-circle"></i> Agregar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Lista de lotes -->
                            <div id="contenedorLotes" class="row g-2"></div>

                            <div class="mt-2 text-end">
                                <small>
                                    <strong>Total Lotes:</strong> <span id="totalLotesSeleccionados">0</span> |
                                    <strong>Superficie:</strong> <span id="totalSuperficieSeleccionada">0.00</span> Ha
                                </small>
                            </div>
                        </div>


                        <!-- TAB RESUMEN -->
                        <div class="tab-pane fade" id="resumen">
                            <h5>Resumen de la Campaña</h5>
                            <ul class="list-group mb-3">
                                <li class="list-group-item"><strong>Nombre:</strong> <span id="resumenNombre"></span></li>
                                <li class="list-group-item"><strong>Estado:</strong> <span id="resumenEstado"></span></li>
                                <li class="list-group-item"><strong>Fecha Inicio:</strong> <span id="resumenFechaInicio"></span></li>
                                <li class="list-group-item"><strong>Fecha Fin:</strong> <span id="resumenFechaFin"></span></li>
                                <li class="list-group-item"><strong>Campo:</strong> <span id="resumenCampo"></span></li>
                                <li class="list-group-item"><strong>Lotes:</strong> <span id="resumenTotalLotes"></span></li>
                                <li class="list-group-item"><strong>Superficie Total:</strong> <span id="resumenTotalSuperficie"></span> Ha</li>
                            </ul>
                            <div id="listaResumenLotes"></div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" id="btnGuardarCampania" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/views/campania.js" asp-append-version="true"></script>
}