@using AgroForm.Web.Models.IndexVM
@model HomeIndexVM

@{
    ViewData["Title"] = "Inicio";
}

<div class="container-fluid">
    <!-- Welcome Section -->
    @*     <div class="welcome-section">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="display-5 fw-bold mb-3">¡Bienvenido a AgroForm!</h1>
                <p class="lead mb-4">Sistema integral de gestión agrícola</p>

                @if (User.Identity.IsAuthenticated)
                {
                    <div class="d-flex align-items-center">
                        <i class="ph ph-check-circle-fill me-2 fs-4"></i>
                        <span class="fs-5">Sesión iniciada como: <strong>@User.Identity.Name</strong></span>
                    </div>
                }
            </div>
            <div class="col-md-4 text-center">
                <i class="ph ph-tree display-1 opacity-75"></i>
            </div>
        </div>
    </div> *@

    <!-- Stats Section -->
    <div class="row g-3 mb-4">
        <!-- Cotización del Dólar -->
        <div class="col-xl-3 col-md-6">
            <div class="card card-hover border-0 shadow-sm">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                        <div class="bg-success bg-opacity-10 rounded-circle p-3 me-3">
                            <i class="ph ph-currency-dollar text-success fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="text-muted small fw-semibold">COTIZACIÓN DÓLAR</div>
                            <div class="h5 mb-1 fw-bold text-success">US$ @Model.CotizacionDolar</div>
                            <div class="text-muted small">@Model.CotizacionFecha</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hectáreas Sembradas -->
        <div class="col-xl-3 col-md-6">
            <div class="card card-hover border-0 shadow-sm">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                        <div class="bg-primary bg-opacity-10 rounded-circle p-3 me-3">
                            <i class="ph ph-plant text-primary fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="text-muted small fw-semibold">HECTÁREAS SEMBRADAS</div>
                                    <div class="h5 mb-0 fw-bold text-primary">@Model.HaSembradas Ha</div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary btn-icon cultivos-popover"
                                        data-bs-toggle="popover"
                                        data-bs-placement="bottom"
                                        data-bs-title="Detalle de Cultivos"
                                        data-bs-html="true"
                                        data-bs-content='
                                            <div class="popover-cultivos">
                                                @foreach (var cultivo in Model.Cultivos)
                                                {
                                                    <div class="d-flex justify-content-between small mb-2">
                                                            <span>@cultivo.CultivoNombre</span>
                                                                <span class="fw-semibold">@cultivo.SuperficieHa.GetValueOrDefault().ToString("N1") Ha</span>
                                                    </div>
                                                }
                                            </div>
                                        '>
                                    <i class="ph ph-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gastos Totales -->
        <div class="col-xl-3 col-md-6">
            <div class="card card-hover border-0 shadow-sm">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                        <div class="bg-danger bg-opacity-10 rounded-circle p-3 me-3">
                            <i class="ph ph-currency-circle-dollar text-danger fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="text-muted small fw-semibold">GASTOS TOTALES</div>
                                    <div class="h5 mb-0 fw-bold text-danger">$@Model.Gastos</div>
                                </div>
                                <button class="btn btn-sm btn-outline-danger btn-icon gastos-popover"
                                        data-bs-toggle="popover"
                                        data-bs-placement="bottom"
                                        data-bs-title="Distribución de Gastos"
                                        data-bs-html="true"
                                        data-bs-content='
                                            <div class="popover-gastos">
                                                @foreach (var gasto in Model.DistribucionGastos)
                                                {
                                                    <div class="d-flex justify-content-between small mb-2">
                                                            <span>@gasto.TipoGasto</span>
                                                            <span class="fw-semibold">$@gasto.Costo.GetValueOrDefault().("N0")</span>
                                                    </div>
                                                }
                                            </div>
                                        '>
                                    <i class="ph ph-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rendimiento Estimado -->
        <div class="col-xl-3 col-md-6">
            <div class="card card-hover border-0 shadow-sm">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                        <div class="bg-info bg-opacity-10 rounded-circle p-3 me-3">
                            <i class="ph ph-chart-line text-info fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
@*                             <div class="text-muted small fw-semibold">RENDIMIENTO ESTIMADO</div>
                            <div class="h5 mb-0 fw-bold text-info">@Model.RendimientoEstimado</div> *@
                            <div class="text-muted small fw-semibold">......</div>
                            <div class="h5 mb-0 fw-bold text-info">.....</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            @await Component.InvokeAsync("CamposActividades")
        </div>

        <div class="col-md-6">
            @await Component.InvokeAsync("ActividadReciente")
            @await Component.InvokeAsync("Lluvia")

        </div>

    </div>

</div>


<script>
    $(document).ready(function() {
        // Inicializar popovers automáticamente
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl);
        });
    });
</script>

<style>
    .btn-icon {
        width: 32px;
        height: 32px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
    }
</style>