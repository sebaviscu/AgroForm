<!-- Lista de Insumos - Componente -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="ph ph-package text-warning me-2"></i>Inventario de Insumos
                </h5>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="ph ph-funnel me-1"></i>Filtrar
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item filtro-insumo active" href="#" data-categoria="todos">Todos los insumos</a></li>
                        <li><a class="dropdown-item filtro-insumo" href="#" data-categoria="fertilizantes">Fertilizantes</a></li>
                        <li><a class="dropdown-item filtro-insumo" href="#" data-categoria="semillas">Semillas</a></li>
                        <li><a class="dropdown-item filtro-insumo" href="#" data-categoria="agroquimicos">Agroquímicos</a></li>
                        <li><a class="dropdown-item filtro-insumo" href="#" data-categoria="herramientas">Herramientas</a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="insumos-container" style="max-height: 400px; overflow-y: auto;">
                    <div class="list-group list-group-flush" id="listaInsumos">
                        <!-- Se llenará dinámicamente -->
                    </div>
                </div>

                <!-- Resumen del inventario -->
                <div class="border-top p-3 bg-light">
                    <div class="row text-center">
                        <div class="col-4">
                            <small class="text-muted d-block">Total Items</small>
                            <strong class="text-primary" id="totalItems">0</strong>
                        </div>
                        <div class="col-4">
                            <small class="text-muted d-block">Stock Bajo</small>
                            <strong class="text-warning" id="stockBajo">0</strong>
                        </div>
                        <div class="col-4">
                            <small class="text-muted d-block">Sin Stock</small>
                            <strong class="text-danger" id="sinStock">0</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // Datos de ejemplo para insumos (reemplazar con API real)
        const insumos = [
            { id: 1, nombre: "Urea Granulada", categoria: "fertilizantes", stock: 150, stockMinimo: 50, unidad: "kg", precio: 450, proveedor: "AgroQuim SA" },
            { id: 2, nombre: "Semilla Soja DM 53", categoria: "semillas", stock: 25, stockMinimo: 10, unidad: "bolsas", precio: 2800, proveedor: "Don Mario" },
            { id: 3, nombre: "Glifosato 5L", categoria: "agroquimicos", stock: 8, stockMinimo: 5, unidad: "bidones", precio: 12500, proveedor: "Monsanto" },
            { id: 4, nombre: "Fertilizante NPK", categoria: "fertilizantes", stock: 80, stockMinimo: 30, unidad: "kg", precio: 680, proveedor: "Yara" },
            { id: 5, nombre: "Semilla Maíz DK 72", categoria: "semillas", stock: 15, stockMinimo: 8, unidad: "bolsas", precio: 3200, proveedor: "Dekalb" },
            { id: 6, nombre: "Insecticida Cyper 25", categoria: "agroquimicos", stock: 3, stockMinimo: 4, unidad: "litros", precio: 8500, proveedor: "Bayer" },
            { id: 7, nombre: "Pala de Punta", categoria: "herramientas", stock: 5, stockMinimo: 2, unidad: "unidades", precio: 2500, proveedor: "Tramontina" },
            { id: 8, nombre: "Fertilizante Foliar", categoria: "fertilizantes", stock: 12, stockMinimo: 5, unidad: "litros", precio: 3200, proveedor: "Stoller" },
            { id: 9, nombre: "Semilla Trigo Bio", categoria: "semillas", stock: 18, stockMinimo: 12, unidad: "bolsas", precio: 1800, proveedor: "BioSemillas" },
            { id: 10, nombre: "Herbicida Selectivo", categoria: "agroquimicos", stock: 6, stockMinimo: 3, unidad: "litros", precio: 7200, proveedor: "Syngenta" },
            { id: 11, nombre: "Carretilla", categoria: "herramientas", stock: 2, stockMinimo: 1, unidad: "unidades", precio: 15000, proveedor: "Tramontina" },
            { id: 12, nombre: "Fertilizante Orgánico", categoria: "fertilizantes", stock: 200, stockMinimo: 100, unidad: "kg", precio: 320, proveedor: "Organico SA" }
        ];

        // Cargar lista de insumos
        function cargarInsumos(categoria = 'todos') {
            const lista = $('#listaInsumos');
            lista.empty();

            let insumosFiltrados = insumos;
            if (categoria !== 'todos') {
                insumosFiltrados = insumos.filter(insumo => insumo.categoria === categoria);
            }

            if (insumosFiltrados.length === 0) {
                lista.append(`
                    <div class="text-center py-5 text-muted">
                        <i class="ph ph-tray display-4"></i>
                        <p class="mt-2">No hay insumos en esta categoría</p>
                    </div>
                `);
                return;
            }

            insumosFiltrados.forEach(insumo => {
                const estadoStock = getEstadoStock(insumo.stock, insumo.stockMinimo);
                const item = crearItemInsumo(insumo, estadoStock);
                lista.append(item);
            });

            actualizarResumen(insumosFiltrados);
        }

        // Crear item de insumo
        function crearItemInsumo(insumo, estadoStock) {
            const badgeColor = estadoStock === 'bajo' ? 'bg-warning' :
                             estadoStock === 'critico' ? 'bg-danger' : 'bg-success';
            const badgeText = estadoStock === 'bajo' ? 'Stock Bajo' :
                            estadoStock === 'critico' ? 'Stock Crítico' : 'Stock OK';

            return `
                <div class="list-group-item list-group-item-action">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1 me-3">
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <h6 class="mb-0">${insumo.nombre}</h6>
                                <span class="badge ${badgeColor}">${badgeText}</span>
                            </div>
                            <div class="row small text-muted">
                                <div class="col-4">
                                    <i class="ph ph-package me-1"></i>${insumo.stock} ${insumo.unidad}
                                </div>
                                <div class="col-4">
                                    <i class="ph ph-warning me-1"></i>Mín: ${insumo.stockMinimo}
                                </div>
                                <div class="col-4">
                                    <i class="ph ph-tag me-1"></i>$${insumo.precio.toLocaleString()}
                                </div>
                            </div>
                            <div class="mt-1">
                                <small class="text-muted">
                                    <i class="ph ph-building me-1"></i>${insumo.proveedor}
                                </small>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ph ph-dots-three-vertical"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="ph ph-eye me-2"></i>Ver Detalles</a></li>
                                <li><a class="dropdown-item" href="#"><i class="ph ph-pencil me-2"></i>Editar</a></li>
                                <li><a class="dropdown-item" href="#"><i class="ph ph-shopping-cart-plus me-2"></i>Reponer</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Barra de progreso del stock -->
                    <div class="mt-2">
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar ${estadoStock === 'critico' ? 'bg-danger' : estadoStock === 'bajo' ? 'bg-warning' : 'bg-success'}"
                                 role="progressbar"
                                 style="width: ${Math.min((insumo.stock / (insumo.stockMinimo * 2)) * 100, 100)}%"
                                 aria-valuenow="${insumo.stock}"
                                 aria-valuemin="0"
                                 aria-valuemax="${insumo.stockMinimo * 2}">
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Determinar estado del stock
        function getEstadoStock(stock, stockMinimo) {
            if (stock === 0) return 'critico';
            if (stock <= stockMinimo) return 'bajo';
            if (stock <= stockMinimo * 1.5) return 'normal';
            return 'ok';
        }

        // Actualizar resumen
        function actualizarResumen(insumosFiltrados) {
            const total = insumosFiltrados.length;
            const bajo = insumosFiltrados.filter(i => getEstadoStock(i.stock, i.stockMinimo) === 'bajo').length;
            const critico = insumosFiltrados.filter(i => getEstadoStock(i.stock, i.stockMinimo) === 'critico').length;

            $('#totalItems').text(total);
            $('#stockBajo').text(bajo);
            $('#sinStock').text(critico);
        }

        // Event Listeners
        $('.filtro-insumo').click(function(e) {
            e.preventDefault();
            const categoria = $(this).data('categoria');

            // Actualizar estado activo
            $('.filtro-insumo').removeClass('active');
            $(this).addClass('active');

            // Actualizar texto del dropdown
            $('#dropdownFiltroInsumo').html(`<i class="ph ph-funnel me-1"></i>${$(this).text()}`);

            cargarInsumos(categoria);
        });

        // Inicializar
        cargarInsumos();
    });
</script>

<style>
    .insumos-container {
        scrollbar-width: thin;
        scrollbar-color: #c1c1c1 #f8f9fa;
    }

        .insumos-container::-webkit-scrollbar {
            width: 6px;
        }

        .insumos-container::-webkit-scrollbar-track {
            background: #f8f9fa;
            border-radius: 3px;
        }

        .insumos-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

            .insumos-container::-webkit-scrollbar-thumb:hover {
                background: #a8a8a8;
            }

    .list-group-item {
        border: none;
        border-bottom: 1px solid #e9ecef !important;
        padding: 1rem;
        transition: background-color 0.2s ease;
    }

        .list-group-item:last-child {
            border-bottom: none !important;
        }

        .list-group-item:hover {
            background-color: #f8f9fa;
        }

    .progress {
        background-color: #e9ecef;
        border-radius: 3px;
    }

    .progress-bar {
        border-radius: 3px;
        transition: width 0.3s ease;
    }

    .dropdown-toggle::after {
        margin-left: 0.25rem;
    }
</style>